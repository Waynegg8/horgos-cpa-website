{{/* 
  Responsive Image Partial (for templates)

  Usage in templates:
  {{ partial "responsive-image.html" (dict 
      "src" "/uploads/images/example.webp" 
      "alt" "說明文字" 
      "class" "optional-class" 
      "lazy" "true" 
      "sizes" "(max-width: 1024px) 100vw, 50vw"
  ) }}

  Accepts keys:
  - src (required)
  - alt (required)
  - class (optional)
  - lazy (optional, default "true")
  - sizes (optional, default "100vw")
*/}}

{{ $src := .src }}
{{ $alt := .alt }}
{{ $class := .class }}
{{ $lazy := default "true" .lazy }}
{{ $sizes := default "100vw" .sizes }}

{{/* 生成響應式圖片路徑 */}}
{{ $desktop := replace $src ".webp" "-1200.webp" }}
{{ $tablet := replace $src ".webp" "-768.webp" }}
{{ $mobile := replace $src ".webp" "-480.webp" }}

{{/* 檔案存在性檢查 */}}
{{ $desktopExists := fileExists (printf "static%s" $desktop) }}
{{ $tabletExists := fileExists (printf "static%s" $tablet) }}
{{ $mobileExists := fileExists (printf "static%s" $mobile) }}

<picture class="responsive-image {{ $class }}" {{ if eq $lazy "true" }}data-lazy="true"{{ end }}>
  {{ if $desktopExists }}
  <source media="(min-width: 1025px)" srcset="{{ $desktop }}">
  {{ end }}
  {{ if $tabletExists }}
  <source media="(min-width: 641px)" srcset="{{ $tablet }}">
  {{ end }}
  {{ if $mobileExists }}
  <source media="(max-width: 640px)" srcset="{{ $mobile }}">
  {{ end }}
  <img 
    src="{{ $src }}" 
    alt="{{ $alt }}" 
    {{ if eq $lazy "true" }}loading="lazy"{{ end }}
    {{ if ne $sizes "100vw" }}sizes="{{ $sizes }}"{{ end }}
    class="responsive-image__img"
    {{ if eq $lazy "true" }}data-src="{{ $src }}"{{ end }}
  >
</picture>

