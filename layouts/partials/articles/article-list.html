<!-- 文章列表頁 -->
<div class="article-list">
    <!-- 搜索框和分類標籤 -->
    <div class="search-section card-style">
        <div class="search-container">
            <form id="search-form" class="search-form">
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input" 
                    placeholder="搜尋文章..." 
                    aria-label="搜尋文章"
                    autocomplete="off"
                >
                <button type="submit" class="search-button" aria-label="搜尋">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>
        
        <!-- 分類搜索標籤 -->
        <div class="category-tags">
            <button class="category-tag category-search-btn active" data-category="all">全部文章</button>
            <button class="category-tag category-search-btn" data-category="startup-guide">創業教室</button>
            <button class="category-tag category-search-btn" data-category="tax-planning">稅務指南</button>
            <button class="category-tag category-search-btn" data-category="accounting-basics">會計實務</button>
            <button class="category-tag category-search-btn" data-category="legal-updates">法規更新</button>
        </div>
    </div>
    
    <!-- 精選文章 -->
    {{ $all := where .Pages "Type" "articles" }}
    {{ $sorted := $all.ByDate.Reverse }}
    {{ if gt (len $sorted) 0 }}
    {{ $featured := index $sorted 0 }}
    <section class="featured-article card-style">
        <a href="{{ $featured.RelPermalink }}" class="featured-article__link">
            <div class="featured-article__media">
                {{ with $featured.Params.cover }}
                <img src="{{ . }}" alt="{{ $featured.Title }}" loading="lazy">
                {{ else }}
                <img src="/uploads/images/general/general-default.jpg" alt="{{ $featured.Title }}" loading="lazy">
                {{ end }}
            </div>
            <div class="featured-article__content">
                <h2 class="featured-article__title">{{ $featured.Title }}</h2>
                <div class="article-meta">
                    <span class="article-meta__item"><i class="fas fa-calendar-alt"></i> {{ $featured.Date.Format "2006-01-02" }}</span>
                    {{ with $featured.Params.category }}<span class="article-meta__item"><i class="fas fa-folder"></i> {{ . }}</span>{{ end }}
                    {{ with $featured.Params.series }}<span class="article-meta__item"><i class="fas fa-bookmark"></i> {{ . }}</span>{{ end }}
                </div>
                <p class="article-summary">{{ with $featured.Summary }}{{ . | truncate 140 }}{{ end }}</p>
                <div>
                    <span class="btn btn-primary btn-sm">閱讀更多</span>
                </div>
            </div>
        </a>
    </section>
    {{ end }}

    <!-- 文章列表 - 左圖右文卡片布局 -->
    <div class="article-list__grid">
        {{ $rest := after 1 $sorted }}
        {{ $paginator := .Paginate $rest 10 }}
        {{ if not (gt (len $paginator.Pages) 0) }}
        <div class="empty-state">目前沒有符合條件的文章。</div>
        {{ end }}
        {{ range $paginator.Pages }}
        <a href="{{ .RelPermalink }}" class="card-style card-clickable article-item" 
           data-category="{{ .Params.category | default "other" }}" 
           data-title="{{ .Title }}" 
           data-summary="{{ .Summary }}">
            <div class="card-horizontal">
                <div class="card-horizontal__image">
                    {{ with .Params.cover }}
                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                    {{ else }}
                    <!-- 根據文章分類選擇合適的預設圖片 -->
                    {{ $defaultImage := "/uploads/images/general/general-default.jpg" }}
                    {{ if eq $.Params.category "創業教室" }}
                        {{ $defaultImage = "/uploads/images/general/general-business-default.jpg" }}
                    {{ else if eq $.Params.category "稅務指南" }}
                        {{ $defaultImage = "/uploads/images/general/general-accounting-default.jpg" }}
                    {{ else if eq $.Params.category "會計實務" }}
                        {{ $defaultImage = "/uploads/images/general/general-accounting-desk.jpg" }}
                    {{ else if eq $.Params.category "法規更新" }}
                        {{ $defaultImage = "/uploads/images/general/general-legal-default.jpg" }}
                    {{ end }}
                    <img src="{{ $defaultImage }}" alt="{{ $.Title }}" loading="lazy">
                    {{ end }}
                </div>
                <div class="card-horizontal__content">
                    <h2 class="article-title">{{ $.Title }}</h2>
                    <div class="article-meta">
                        <span class="article-meta__item"><i class="fas fa-calendar-alt"></i> {{ $.Date.Format "2006-01-02" }}</span>
                        {{ with $.Params.category }}
                        <span class="article-meta__item"><i class="fas fa-folder"></i> {{ . }}</span>
                        {{ end }}
                        {{ with $.Params.series }}
                        <span class="article-meta__item"><i class="fas fa-bookmark"></i> {{ . }}</span>
                        {{ end }}
                    </div>
                    <p class="article-summary">{{ $.Summary | truncate 100 }}</p>
                </div>
            </div>
        </a>
        {{ end }}
    </div>
    
    <!-- 分頁導航 -->
    {{ if gt .Paginator.TotalPages 1 }}
    <nav class="pagination" role="navigation" aria-label="分頁導航">
        <div class="pagination__info">
            第 {{ .Paginator.PageNumber }} / {{ .Paginator.TotalPages }} 頁，共 {{ .Paginator.TotalNumberOfElements }} 篇文章
        </div>
        <div class="pagination__controls">
            {{ if .Paginator.HasPrev }}
                <a href="{{ .Paginator.Prev.URL }}" class="pagination__link pagination__link--prev" aria-label="上一頁">
                    <i class="fas fa-chevron-left"></i>
                    上一頁
                </a>
            {{ end }}
            
            {{ range .Paginator.Pagers }}
                {{ if eq . $.Paginator }}
                    <span class="pagination__link pagination__link--current" aria-current="page">{{ .PageNumber }}</span>
                {{ else }}
                    <a href="{{ .URL }}" class="pagination__link">{{ .PageNumber }}</a>
                {{ end }}
            {{ end }}
            
            {{ if .Paginator.HasNext }}
                <a href="{{ .Paginator.Next.URL }}" class="pagination__link pagination__link--next" aria-label="下一頁">
                    下一頁
                    <i class="fas fa-chevron-right"></i>
                </a>
            {{ end }}
        </div>
    </nav>
    {{ end }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const categoryButtons = document.querySelectorAll('.category-search-btn');
    const articleItems = document.querySelectorAll('.article-item');
    
    // 分類標籤點擊事件
    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // 更新標籤狀態
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // 執行搜索
            if (category === 'all') {
                searchInput.value = '';
            } else {
                searchInput.value = this.textContent;
            }
            
            // 觸發搜索
            performSearch();
        });
    });
    
    // 搜索表單提交
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        performSearch();
    });
    
    // 搜索功能
    function performSearch() {
        const query = searchInput.value.trim();
        
        articleItems.forEach(article => {
            const title = article.querySelector('.article-title').textContent.toLowerCase();
            const summary = article.querySelector('.article-summary').textContent.toLowerCase();
            const category = article.querySelector('.article-meta__item:last-child')?.textContent.toLowerCase() || '';
            const itemCategory = article.dataset.category;
            
            const searchText = query.toLowerCase();
            
            // 檢查是否匹配搜索條件
            const matchesSearch = query === '' || 
                title.includes(searchText) || 
                summary.includes(searchText) || 
                category.includes(searchText);
            
            // 檢查是否匹配分類
            const activeCategory = document.querySelector('.category-search-btn.active').dataset.category;
            const matchesCategory = activeCategory === 'all' || itemCategory === activeCategory;
            
            if (matchesSearch && matchesCategory) {
                article.style.display = 'block';
            } else {
                article.style.display = 'none';
            }
        });
    }
    
    // 初始化：選中"全部文章"
    document.querySelector('[data-category="all"]').classList.add('active');
});
</script>
