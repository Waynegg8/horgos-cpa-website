<!-- 文章側邊欄 -->
<div class="sidebar">
    {{ if and (eq .Kind "page") (eq .Section "articles") }}
    <!-- 側邊搜尋（單一文章頁專用）：提交後導向列表頁並帶入關鍵字 -->
    <form class="sidebar-widget sidebar-search" action="/articles/" method="get" role="search" aria-label="文章搜尋">
        <input type="search" name="q" class="sidebar-search__input" placeholder="搜尋文章..." aria-label="搜尋文章" />
        <button type="submit" class="btn btn-primary btn-sm sidebar-search__btn">搜尋</button>
    </form>
    {{ end }}
    <!-- 分類列表 -->
    <div class="sidebar-widget sidebar-categories">
        <h3 class="sidebar-widget__title">文章分類</h3>
        <ul class="sidebar-categories__list">
            <li class="sidebar-categories__item">
                <a href="/articles/startup-guide/" class="sidebar-categories__link">
                    創業教室
                    <span class="sidebar-categories__count">{{ len (where .Site.RegularPages "Section" "articles") }}</span>
                </a>
            </li>
            <li class="sidebar-categories__item">
                <a href="/articles/tax-planning/" class="sidebar-categories__link">
                    稅務指南
                    <span class="sidebar-categories__count">{{ len (where .Site.RegularPages "Section" "articles") }}</span>
                </a>
            </li>
            <li class="sidebar-categories__item">
                <a href="/articles/accounting-basics/" class="sidebar-categories__link">
                    會計實務
                    <span class="sidebar-categories__count">{{ len (where .Site.RegularPages "Section" "articles") }}</span>
                </a>
            </li>
            <li class="sidebar-categories__item">
                <a href="/articles/legal-updates/" class="sidebar-categories__link">
                    法規更新
                    <span class="sidebar-categories__count">{{ len (where .Site.RegularPages "Section" "articles") }}</span>
                </a>
            </li>
        </ul>
    </div>
    
    <!-- 系列列表 -->
    <div class="sidebar-widget sidebar-series">
        <h3 class="sidebar-widget__title">系列文章</h3>
        <ul class="sidebar-series__list">
            <li class="sidebar-series__item">
                <a href="/articles/startup-guide/" class="sidebar-series__link">
                    公司設立系列
                </a>
            </li>
            <li class="sidebar-series__item">
                <a href="/articles/tax-planning/" class="sidebar-series__link">
                    稅務規劃系列
                </a>
            </li>
            <li class="sidebar-series__item">
                <a href="/articles/accounting-basics/" class="sidebar-series__link">
                    會計入門系列
                </a>
            </li>
        </ul>
    </div>

    <!-- 目錄：應位於系列文章下、標籤雲上 -->
    {{ if and (eq .Kind "page") (eq .Section "articles") }}
    {{ partial "sidebar/table-of-contents.html" . }}
    {{ end }}
    
    {{ if ne .Kind "page" }}
    <!-- 最新文章：僅列表頁顯示，單一文章頁不顯示 -->
    <div class="sidebar-widget sidebar-recent">
        <h3 class="sidebar-widget__title">最新文章</h3>
        <ul class="sidebar-recent__list">
            {{ range first 5 (where .Site.RegularPages "Section" "articles") }}
            <li class="sidebar-recent__item">
                <a href="{{ .RelPermalink }}" class="sidebar-recent__link">
                    <div class="sidebar-recent__thumbnail">
                        {{ with .Params.image }}
                        <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                        {{ else }}
                        <img src="/uploads/images/general/general-default.jpg" alt="{{ $.Title }}" loading="lazy">
                        {{ end }}
                    </div>
                    <div class="sidebar-recent__content">
                        <div class="sidebar-recent__title">{{ .Title }}</div>
                        <div class="sidebar-recent__date">{{ .Date.Format "2006-01-02" }}</div>
                    </div>
                </a>
            </li>
            {{ end }}
        </ul>
    </div>
    {{ end }}
    
    <!-- 標籤雲 -->
    <div class="sidebar-widget sidebar-tags">
        <h3 class="sidebar-widget__title">標籤雲</h3>
        <div class="sidebar-tags__cloud">
            {{ range $name, $_ := .Site.Taxonomies.tags }}
                <a class="sidebar-tags__tag" href="{{ (printf "/tags/%s/" (urlize $name)) | relURL }}">{{ $name }}</a>
            {{ end }}
        </div>
    </div>
    
</div>