{{ $youtube_id := (trim (.Params.youtube_id | default "") " ") }}
{{ $vimeo_id := (trim (.Params.vimeo_id | default "") " ") }}
{{/* 視為有效的條件：存在、長度足夠、且不是佔位字樣 */}}
{{ $yt_valid := and (ne $youtube_id "") (ge (len $youtube_id) 8) (not (in (lower $youtube_id) "xxxx")) }}
{{ $vimeo_valid := and (ne $vimeo_id "") (ge (len $vimeo_id) 6) (not (in (lower $vimeo_id) "xxxx")) }}

<div class="video-player-container">
  {{ if $yt_valid }}
    <div class="video-responsive">
      <iframe 
        src="https://www.youtube.com/embed/{{ $youtube_id }}" 
        title="{{ .Title }}"
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen
        loading="lazy"
        referrerpolicy="strict-origin-when-cross-origin"
        decoding="async">
      </iframe>
    </div>
  {{ else if $vimeo_valid }}
    <div class="video-responsive">
      <iframe 
        src="https://player.vimeo.com/video/{{ $vimeo_id }}" 
        title="{{ .Title }}"
        frameborder="0" 
        allow="autoplay; fullscreen; picture-in-picture" 
        allowfullscreen
        loading="lazy"
        referrerpolicy="strict-origin-when-cross-origin"
        decoding="async">
      </iframe>
    </div>
  {{ else }}
    <div class="video-fallback" aria-label="本頁暫無可嵌入影片">
      <div class="video-fallback__media">
        {{ with .Params.thumbnail }}
          <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" decoding="async" />
        {{ else }}
          <img src="/uploads/images/general/general-default.jpg" alt="{{ $.Title }}" loading="lazy" decoding="async" />
        {{ end }}
      </div>
      <div class="video-fallback__note">本頁目前以圖文說明呈現，影片將於近期上線。</div>
    </div>
  {{ end }}
</div>