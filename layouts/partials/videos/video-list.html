<!-- 影片列表頁 -->
<div class="video-list">
    <!-- 精選影片 -->
    {{ $all := where .Site.RegularPages "Section" "videos" }}
    {{ $sorted := $all.ByDate.Reverse }}
    {{ if gt (len $sorted) 0 }}
    {{ $featured := index $sorted 0 }}
    <section class="featured-article card-style">
        <a href="{{ $featured.RelPermalink }}" class="featured-article__link">
            <div class="featured-article__media">
                {{ with $featured.Params.thumbnail }}
                <img src="{{ . }}" alt="{{ $featured.Title }}" loading="lazy">
                {{ else }}
                <img src="/uploads/images/general/general-default.jpg" alt="{{ $featured.Title }}" loading="lazy">
                {{ end }}
            </div>
            <div class="featured-article__content">
                <h2 class="featured-article__title">{{ $featured.Title }}</h2>
                <div class="video-card__meta">
                    <span class="video-card__date"><i class="fas fa-calendar-alt"></i> {{ $featured.Date.Format "2006-01-02" }}</span>
                    {{ with $featured.Params.category }}<span class="video-card__category"><i class="fas fa-folder"></i> {{ . }}</span>{{ end }}
                    {{ with $featured.Params.series }}<span class="video-card__series"><i class="fas fa-bookmark"></i> {{ . }}</span>{{ end }}
                </div>
                <div class="video-card__excerpt">{{ with $featured.Summary }}{{ . | truncate 140 }}{{ end }}</div>
                <div>
                    <span class="btn btn-primary btn-sm">觀看影片</span>
                </div>
            </div>
        </a>
    </section>
    {{ end }}

    <!-- 分類標籤（無全域搜尋） -->
    <div class="video-categories">
        <div class="category-filters">
            <button class="category-filter category-search-btn active" data-category="all">全部</button>
            <button class="category-filter category-search-btn" data-category="popular">熱門影片</button>
            <button class="category-filter category-search-btn" data-category="tutorials">教學影片</button>
            <button class="category-filter category-search-btn" data-category="case-studies">案例分享</button>
            <button class="category-filter category-search-btn" data-category="legal-explanation">法規解說</button>
        </div>
    </div>
    
    <!-- 影片列表（僅分類篩選，不依賴全域搜尋） -->
    <div class="video-cards">
        {{ $rest := after 1 $sorted }}
        {{ $paginator := .Paginate $rest 10 }}
        {{ if not (gt (len $paginator.Pages) 0) }}
        <div class="empty-state">目前沒有符合條件的影片。</div>
        {{ end }}
        {{ range $paginator.Pages }}
        <a href="{{ .RelPermalink }}" class="video-card card-style card-clickable video-item"
           data-category="{{ (.Params.category | default "other") | urlize }}"
           data-title="{{ .Title }}"
           data-summary="{{ .Summary }}">
            <div class="video-card__thumbnail">
                {{ with .Params.thumbnail }}
                <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                {{ else }}
                <img src="/uploads/images/general/general-default.jpg" alt="{{ $.Title }}" loading="lazy">
                {{ end }}
                {{ with .Params.duration }}
                <span class="video-card__duration">{{ . }}</span>
                {{ end }}
            </div>
            <div class="video-card__content">
                <h2 class="video-card__title">{{ .Title }}</h2>
                <div class="video-card__meta">
                    <span class="video-card__date"><i class="fas fa-calendar-alt"></i> {{ .Date.Format "2006-01-02" }}</span>
                    {{ with .Params.category }}
                    <span class="video-card__category"><i class="fas fa-folder"></i> {{ . }}</span>
                    {{ end }}
                    {{ with .Params.series }}
                    <span class="video-card__series"><i class="fas fa-bookmark"></i> {{ . }}</span>
                    {{ end }}
                </div>
                <div class="video-card__excerpt">{{ .Summary }}</div>
                <div class="video-card__footer">
                    <span class="video-card__watch">觀看影片</span>
                </div>
            </div>
        </a>
        {{ end }}
    </div>
    
    <!-- 分頁導航 -->
    {{ template "_internal/pagination.html" . }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryButtons = document.querySelectorAll('.category-search-btn');
    const videoItems = document.querySelectorAll('.video-item');
    
    // 分類標籤點擊事件
    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // 更新按鈕狀態
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // 篩選影片項目
            videoItems.forEach(item => {
                const itemCategory = item.dataset.category;
                
                if (category === 'all' || itemCategory === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
});
</script>