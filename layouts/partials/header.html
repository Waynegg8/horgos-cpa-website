<!-- 
  ==============================================================================
  Site Header - Refactored to match Linear.app's structure
  ==============================================================================
-->
<header class="site-header" id="site-header">
  <div class="container site-header__container">

    <!-- Logo -->
    <div class="site-header__logo">
      <a href="{{ .Site.BaseURL | relLangURL }}">
        <!-- 建議使用 SVG Logo 以獲得最佳效果 -->
        {{ with .Site.Params.logo }}
          <img src="{{ .light | relURL }}" alt="{{ $.Site.Title }} Logo" class="logo-light">
          <img src="{{ .dark | relURL }}" alt="{{ $.Site.Title }} Logo" class="logo-dark">
        {{ else }}
          <span>{{ .Site.Title }}</span>
        {{ end }}
      </a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="site-header__nav site-header__nav--desktop">
      <ul class="nav-list">
        {{ $currentPage := . }}
        {{ range .Site.Menus.main }}
          {{ $isParent := .HasChildren }}
          {{ $isActive := $currentPage.HasMenuCurrent "main" . }}
          <li class="nav-item {{ if $isParent }}has-dropdown{{ end }} {{ if $isActive }}is-active{{ end }}">
            <a href="{{ .URL | relLangURL }}" class="nav-link">
              <span>{{ .Name }}</span>
              {{ if $isParent }}
                <svg class="nav-link__icon" viewBox="0 0 16 16" width="12" height="12" fill="currentColor"><path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z"></path></svg>
              {{ end }}
            </a>
            {{ if $isParent }}
              <div class="dropdown-menu">
                <div class="dropdown-menu__content">
                  {{ range .Children }}
                    {{ $isChildActive := $currentPage.IsMenuCurrent "main" . }}
                    <a href="{{ .URL | relLangURL }}" class="dropdown-item {{ if $isChildActive }}is-active{{ end }}">
                      {{ .Name }}
                    </a>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          </li>
        {{ end }}
      </ul>
    </nav>

    <!-- Header Actions (e.g., CTA Button) -->
    <div class="site-header__actions">
      {{ with .Site.Params.cta.header }}
        <a href="{{ .url | relLangURL }}" class="btn btn--primary btn--small">{{ .text }}</a>
      {{ end }}

      <!-- Mobile Nav Toggle -->
      <button class="site-header__mobile-toggle" id="mobile-nav-toggle" aria-label="Toggle navigation">
        <span class="line line--1"></span>
        <span class="line line--2"></span>
        <span class="line line--3"></span>
      </button>
    </div>

  </div>

  <!-- Mobile Navigation Panel -->
  <div class="mobile-nav" id="mobile-nav">
    <nav class="mobile-nav__menu">
       <ul class="mobile-nav__list">
        {{ range .Site.Menus.main }}
          {{ $isParent := .HasChildren }}
           <li class="mobile-nav__item {{ if $isParent }}has-dropdown{{ end }}">
             <a href="{{ if not $isParent }}{{ .URL | relLangURL }}{{ else }}#{{ end }}" class="mobile-nav__link" {{ if $isParent }}data-toggle-dropdown{{end}}>
               <span>{{ .Name }}</span>
               {{ if $isParent }}
                <svg class="nav-link__icon" viewBox="0 0 16 16" width="12" height="12" fill="currentColor"><path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z"></path></svg>
               {{ end }}
              </a>
             {{ if $isParent }}
               <ul class="mobile-nav__dropdown">
                 {{ range .Children }}
                   <li><a href="{{ .URL | relLangURL }}" class="mobile-nav__dropdown-link">{{ .Name }}</a></li>
                 {{ end }}
               </ul>
             {{ end }}
           </li>
        {{ end }}
      </ul>
    </nav>
  </div>
</header>
