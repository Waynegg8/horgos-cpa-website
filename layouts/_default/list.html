{{ define "main" }}
<!-- 統一頁面標題設計 -->
{{ if ne .Section "home" }}
<div class="page-header">
  <div class="container">
    <div class="page-header__content">
      <h1 class="page-header__title">{{ .Title }}</h1>
      <div class="page-header__line"></div>
      {{ with .Description }}
      <p class="page-header__description">{{ . }}</p>
      {{ end }}
    </div>
  </div>
</div>
{{ end }}

<div class="container container--content">
    <div class="two-column">
        <div class="two-column__main">
            <!-- 移除主內容區的重複導言，避免與 hero 區文案冗餘 -->
            
            {{ if eq .Section "about" }}
            <!-- 關於我們頁面內容 -->
            {{ else if eq .Section "services" }}
            <!-- 服務總覽頁：卡片 + 內容敘述區塊 -->
            {{ partial "services/service-cards.html" . }}
            {{ partial "services/service-features.html" . }}
            {{ partial "services/service-process.html" . }}
            {{ partial "services/service-commitment.html" . }}
            {{ else if eq .Section "articles" }}
            <!-- 文章列表頁面內容（支援 ?tag= 以標籤篩選） -->
            {{/* 根據 URL 參數 tag 篩選文章 */}}
            {{ $allArticles := where .Site.RegularPages "Section" "articles" }}
            {{ $allArticles = where $allArticles "Params.draft" "!=" true }}

            {{ $tag := "" }}
            {{ if .URL.Query.Get "tag" }}
              {{ $tag = .URL.Query.Get "tag" }}
            {{ end }}

            {{ $filteredArticles := $allArticles }}
            {{ if $tag }}
              {{ $filteredArticles = where $allArticles "Params.tags" "intersect" (slice $tag) }}
            {{ end }}

            {{ $paginator := .Paginate $filteredArticles }}
            {{ partial "articles/article-list.html" (dict "Paginator" $paginator "Tag" $tag "Page" .) }}
            <script>
            // 列表頁自動帶入 q 參數並觸發在地搜尋（文章/影片/FAQ/下載）
            document.addEventListener('DOMContentLoaded', function() {
              const params = new URLSearchParams(window.location.search);
              const q = params.get('q');
              if (!q) return;
              const ids = ['article-search-input','video-search-input','faq-search-input','download-search-input'];
              ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                  el.value = q;
                  el.dispatchEvent(new Event('input', { bubbles: true }));
                }
              });
            });
            </script>
            {{ else if eq .Section "videos" }}
            <!-- 影片列表頁面內容 -->
            {{ partial "videos/video-list.html" . }}
            {{ else if eq .Section "faq" }}
            <!-- FAQ列表頁面內容 -->
            {{ partial "faq/faq-list.html" . }}
            {{ else if eq .Section "downloads" }}
            <!-- 下載列表頁面內容 -->
            {{ partial "downloads/download-list.html" . }}
            {{ end }}
        </div>
        
        <!-- 側邊欄（所有列表頁：articles / videos / faq / downloads） -->
        {{ if in (slice "articles" "videos" "faq" "downloads") .Section }}
        <div class="two-column__sidebar">
            {{ if eq .Section "articles" }}
                {{ if eq .Kind "section" }}
                    {{ partial "sidebar/articles-list-sidebar.html" . }}
                {{ else }}
                    {{ partial "sidebar/articles-sidebar.html" . }}
                {{ end }}
            {{ else if eq .Section "videos" }}
                {{ partial "sidebar/videos-sidebar.html" . }}
            {{ else if eq .Section "faq" }}
                {{ partial "sidebar/faq-sidebar.html" . }}
            {{ else if eq .Section "downloads" }}
                {{ partial "sidebar/downloads-sidebar.html" . }}
            {{ end }}
        </div>
        {{ end }}
    </div>
    {{ if eq .Section "downloads" }}
    <!-- 下載須知 (移到CTA上方) -->
    {{ partial "downloads/download-notice.html" . }}
    {{ end }}
    
    {{/* 列表頁不再在此輸出 CTA，統一由 baseof 在 SEO 區塊上方輸出 */}}
</div>
{{ end }}