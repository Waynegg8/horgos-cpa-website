{{ define "main" }}
  <section class="container list-page" style="padding-top:80px;">
    <h1>{{ .Title }}</h1>
    {{ with .Content }}
    <div class="list-intro">
      {{ . }}
    </div>
    {{ end }}

    {{/* 特殊處理：服務列表採用卡片樣式呈現 */}}
    {{ if eq .Section "services" }}
      <div class="service-list">
        {{ range .Pages }}
          {{ $icon := "" }}
          {{- if eq .File.BaseFileName "tax" }}{{ $icon = "fa-file-invoice-dollar" }}{{ else if eq .File.BaseFileName "registration" }}{{ $icon = "fa-building" }}{{ else if eq .File.BaseFileName "attestation" }}{{ $icon = "fa-stamp" }}{{ else if eq .File.BaseFileName "advisory" }}{{ $icon = "fa-hand-holding-usd" }}{{ end }}
      <a href="{{ .RelPermalink }}" class="service-card" style="background-color: var(--color-white); border-radius: 8px; padding:1.5rem; box-shadow:0 2px 6px rgba(0,0,0,0.05); display:flex; align-items:flex-start; margin-bottom:1.5rem; text-decoration:none; color:inherit;">
            <div class="service-icon" style="margin-right:1rem; font-size:2rem; color: var(--color-secondary);">
              <i class="fas {{ $icon }}"></i>
            </div>
            <div class="service-info">
              <h2 style="margin-top:0;">{{ .Title }}</h2>
              {{ with .Params.description }}<p>{{ . }}</p>{{ end }}
            </div>
          </a>
        {{ end }}
      </div>
    {{ else }}
      {{/* 其他列表：文章、常見問題、影音與下載。若為系列 taxonomy 頁，僅顯示對應 Section 的內容。*/}}
      {{ $pages := .Pages }}
      {{ if eq .Kind "term" }}
        {{/* 將系列名稱對應至 Section，過濾頁面以防不同 Section 混合 */}}
        {{ $seriesSection := dict
          "稅務規劃" "articles"
          "創業指南" "articles"
          "熱門文章" "articles"
          "稅務問題" "faq"
          "創業問題" "faq"
          "熱門問答" "faq"
          "教學影片" "videos"
          "熱門影片" "videos"
          "範本下載" "downloads"
          "熱門下載" "downloads"
        }}
        {{ $targetSection := index $seriesSection .Title }}
        {{ if $targetSection }}
          {{ $pages = where .Pages "Section" $targetSection }}
        {{ end }}
      {{ end }}
      {{ $paginator := .Paginate $pages }}
      <!-- 列表頁篩選區：搜尋與分類標籤 -->
      <div class="list-controls">
        <input type="text" id="list-search" placeholder="搜尋{{ .Title }}..." aria-label="搜尋 {{ .Title }}...">
        <div class="category-tags">
          {{/* 根據 Section 顯示相應分類；預設不顯示「全部」，使用空白代表全部 */}}
          {{ if eq .Section "articles" }}
            <button class="category-tag" data-category="稅務規劃">稅務規劃</button>
            <button class="category-tag" data-category="創業指南">創業指南</button>
            <button class="category-tag" data-category="熱門文章">熱門文章</button>
          {{ else if eq .Section "faq" }}
            <button class="category-tag" data-category="稅務問題">稅務問題</button>
            <button class="category-tag" data-category="創業問題">創業問題</button>
            <button class="category-tag" data-category="熱門問答">熱門問答</button>
          {{ else if eq .Section "videos" }}
            <button class="category-tag" data-category="教學影片">教學影片</button>
            <button class="category-tag" data-category="熱門影片">熱門影片</button>
          {{ else if eq .Section "downloads" }}
            <button class="category-tag" data-category="範本下載">範本下載</button>
            <button class="category-tag" data-category="熱門下載">熱門下載</button>
          {{ end }}
        </div>
      </div>
      <div class="list-container">
        <div class="list-main">
          <div class="post-list">
            {{ range $paginator.Pages }}
              <div class="post-card" data-series="{{ with .Params.series }}{{ index . 0 }}{{ end }}" data-categories="{{ with .Params.categories }}{{ delimit . "," }}{{ end }}" style="background-color: var(--color-white); border-radius: 8px; padding:1.5rem; box-shadow:0 2px 6px rgba(0,0,0,0.05); margin-bottom:1.5rem;">
                <h2 style="margin-top:0;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
                {{ with .Params.description }}<p>{{ . }}</p>{{ end }}
                <div class="post-meta" style="font-size:0.85rem; color:var(--color-muted);">
                  {{ with .Date }}<span class="post-date">{{ . | dateFormat "2006-01-02" }}</span>{{ end }}
                  {{ with .Params.categories }}
                    <span class="post-categories">｜{{ delimit . ", " }}</span>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          </div>
          {{ if gt ($paginator.TotalPages) 1 }}
            <nav class="pagination" style="display:flex; gap:0.5rem; justify-content:center; margin:2rem 0;">
              {{ if $paginator.HasPrev }}
                <a href="{{ $paginator.Prev.URL }}" class="page-link">上一頁</a>
              {{ end }}
              {{ range $paginator.Pagers }}
                <a href="{{ .URL }}" class="page-link {{ if eq . $paginator }}active{{ end }}">{{ .PageNumber }}</a>
              {{ end }}
              {{ if $paginator.HasNext }}
                <a href="{{ $paginator.Next.URL }}" class="page-link">下一頁</a>
              {{ end }}
            </nav>
          {{ end }}
        </div>
        <aside class="list-sidebar">
          {{ partial "sidebar-list.html" . }}
        </aside>
      </div>
    {{ end }}
    {{ partial "seo.html" . }}
  </section>
{{ end }}