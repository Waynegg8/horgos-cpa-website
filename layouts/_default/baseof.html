<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "zh-tw" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ with .Params.seo_title }}{{ . }}{{ else }}{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}{{ end }}</title>
    <meta name="description" content="{{ with .Params.seo_description }}{{ . }}{{ else }}{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . | plainify | safeHTML | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}{{ end }}">
    
    <!-- SEO Meta Tags -->
    {{ if .Params.seo_title }}<meta property="og:title" content="{{ .Params.seo_title }}">{{ else }}<meta property="og:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta property="og:description" content="{{ .Params.seo_description }}">{{ else }}<meta property="og:description" content="{{ .Description }}">{{ end }}
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    {{ with .Params.cover }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    {{ if .Params.seo_title }}<meta name="twitter:title" content="{{ .Params.seo_title }}">{{ else }}<meta name="twitter:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta name="twitter:description" content="{{ .Params.seo_description }}">{{ else }}<meta name="twitter:description" content="{{ .Description }}">{{ end }}
    {{ with .Params.cover }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Favicon -->
    <link rel="icon" sizes="16x16" href="{{ $.Site.Params.favicon.icon16 | default "/uploads/images/general/general-favicon-16x16.png" }}">
    <link rel="icon" sizes="32x32" href="{{ $.Site.Params.favicon.icon32 | default "/uploads/images/general/general-favicon-32x32.png" }}">
    <link rel="icon" href="{{ $.Site.Params.favicon.ico | default "/uploads/images/general/general-favicon.ico" }}">
    <link rel="apple-touch-icon" href="{{ $.Site.Params.favicon.ico | default "/uploads/images/general/general-favicon.ico" }}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Main CSS -->
    {{ $style := resources.Get "scss/main.scss" | css.Sass | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
    
    <!-- Custom CSS -->
    {{ range .Site.Params.customCSS }}
    <link rel="stylesheet" href="{{ . | relURL }}">
    {{ end }}
    
    <!-- Google Analytics -->
    {{ template "_internal/google_analytics.html" . }}
    
    <!-- 結構化資料 Schema.org -->
    {{ partial "head/schema.html" . }}
</head>
<body class="{{ if .IsHome }}home{{ else }}{{ .Section }}{{ end }}" data-section="{{ .Section }}" data-template="custom-baseof">
    <!-- 無障礙跳過連結 -->
    {{ partial "skip-links.html" . }}
    
    <!-- 無障礙ARIA標籤 -->
    {{ partial "aria-labels.html" . }}
    
    <!-- 頁面載入進度條由JavaScript動態創建 -->
    
    <!-- 導航欄 -->
    <header>
        <nav id="main-navigation" aria-labelledby="aria-nav-desc">
            {{ partial "header.html" . }}
        </nav>
    </header>
    
    <!-- 主要內容 -->
    <main id="main-content" aria-labelledby="aria-main-desc">
        {{ block "main" . }}{{ end }}
    </main>
    
    <!-- 側邊欄區塊由各頁面模板自行處理 -->
    
    <!-- SEO區塊 -->
    {{ partial "seo-content.html" . }}
    
    <!-- 頁腳 -->
    <footer id="footer" aria-labelledby="aria-footer-desc">
        {{ partial "footer.html" . }}
    </footer>
    
    <!-- Cookie同意條款 -->
    <div id="cookie-consent" class="cookie-consent" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-desc">
        <div class="cookie-consent__content">
            <h2 id="cookie-title" class="sr-only">Cookie 使用同意</h2>
            <p id="cookie-desc">本網站使用Cookie來改善您的瀏覽體驗。繼續使用本網站，即表示您同意我們的<a href="/cookies-policy/">Cookies政策</a>。</p>
            <button id="cookie-accept" class="btn btn-secondary" aria-label="接受Cookie使用條款">接受</button>
        </div>
    </div>
    
    <!-- 浮動按鈕組 -->
    <div class="floating-buttons">
        <!-- 社群媒體按鈕組 -->
        <div class="social-buttons">
            <button id="social-toggle" class="social-toggle" aria-label="社群媒體連結" aria-expanded="false">
                <i class="fas fa-share-alt"></i>
            </button>
            
            <div class="social-buttons__menu" aria-hidden="true">
                {{ with .Site.Params.widgets.social.line }}
                <a href="https://line.me/R/ti/p/{{ . }}" class="social-button line" target="_blank" rel="noopener" aria-label="LINE">
                    <i class="fab fa-line"></i>
                </a>
                {{ end }}
                
                {{ with .Site.Params.widgets.social.facebook }}
                <a href="https://facebook.com/{{ . }}" class="social-button facebook" target="_blank" rel="noopener" aria-label="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                {{ end }}
                
                {{ with .Site.Params.widgets.social.instagram }}
                <a href="https://instagram.com/{{ . }}" class="social-button instagram" target="_blank" rel="noopener" aria-label="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                {{ end }}
                
                {{ with .Site.Params.widgets.social.email }}
                <a href="mailto:{{ . }}" class="social-button email" aria-label="Email">
                    <i class="fas fa-envelope"></i>
                </a>
                {{ end }}
            </div>
        </div>
        
        <!-- 回到頂端按鈕 (獨立於社群媒體按鈕下方) -->
        <button id="back-to-top" class="back-to-top" aria-label="回到頂端">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>
    
    <!-- Main JavaScript -->
    {{ $script := resources.Get "js/main.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $script.RelPermalink }}"></script>
    
    <!-- Component JavaScript -->
    <!-- 載入狀態系統 -->
    {{ $loadingScript := resources.Get "js/components/loading.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $loadingScript.RelPermalink }}"></script>
    
    <!-- 回到頂端按鈕 -->
    {{ $backToTopScript := resources.Get "js/components/back-to-top.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $backToTopScript.RelPermalink }}"></script>

    <!-- Header滾動效果 -->
    {{ $headerScrollScript := resources.Get "js/components/headerScroll.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $headerScrollScript.RelPermalink }}"></script>

    <!-- 行動版導覽 -->
    {{ $mobileNavScript := resources.Get "js/components/mobileNav.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $mobileNavScript.RelPermalink }}"></script>

    <!-- 頁腳摺疊 -->
    {{ $footerCollapseScript := resources.Get "js/components/footerCollapse.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $footerCollapseScript.RelPermalink }}"></script>
    
    <!-- Hero 輪播功能 (僅首頁) -->
    {{ if .IsHome }}
    {{ $heroCarouselScript := resources.Get "js/components/hero-carousel.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $heroCarouselScript.RelPermalink }}"></script>
    {{ end }}
    
    
    
    {{ if and (eq .Section "articles") (eq .Kind "page") }}
    {{ $tocScript := resources.Get "js/components/toc.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $tocScript.RelPermalink }}"></script>
    {{ end }}
    
    <!-- Custom JavaScript -->
    {{ range .Site.Params.customJS }}
    <script src="{{ . | relURL }}"></script>
    {{ end }}
</body>
</html>