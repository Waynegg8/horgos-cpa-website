<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "zh-tw" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} - {{ .Site.Title }}{{ end }}</title>
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}">
    
    <!-- SEO Meta Tags -->
    {{ if .Params.seo_title }}<meta property="og:title" content="{{ .Params.seo_title }}">{{ else }}<meta property="og:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta property="og:description" content="{{ .Params.seo_description }}">{{ else }}<meta property="og:description" content="{{ .Description }}">{{ end }}
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    {{ with .Params.cover }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    {{ if .Params.seo_title }}<meta name="twitter:title" content="{{ .Params.seo_title }}">{{ else }}<meta name="twitter:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta name="twitter:description" content="{{ .Params.seo_description }}">{{ else }}<meta name="twitter:description" content="{{ .Description }}">{{ end }}
    {{ with .Params.cover }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.ico">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Main CSS -->
    {{ $style := resources.Get "scss/main.scss" | resources.ToCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
    
    <!-- Custom CSS -->
    {{ range .Site.Params.customCSS }}
    <link rel="stylesheet" href="{{ . | relURL }}">
    {{ end }}
    
    <!-- Google Analytics -->
    {{ template "_internal/google_analytics.html" . }}
</head>
<body class="{{ if .IsHome }}home{{ else }}{{ .Section }}{{ end }}" data-section="{{ .Section }}">
    <!-- 無障礙跳過連結 -->
    {{ partial "skip-links.html" . }}
    
    <!-- 無障礙ARIA標籤 -->
    {{ partial "aria-labels.html" . }}
    
    <!-- 頁面載入進度條由JavaScript動態創建 -->
    
    <!-- 導航欄 -->
    <header>
        <nav id="main-navigation" aria-labelledby="aria-nav-desc">
            {{ partial "header.html" . }}
        </nav>
    </header>
    
    <!-- 主要內容 -->
    <main id="main-content" aria-labelledby="aria-main-desc">
        {{ block "main" . }}{{ end }}
    </main>
    
    <!-- 頁腳 -->
    <footer id="footer" aria-labelledby="aria-footer-desc">
        {{ partial "footer.html" . }}
    </footer>
    
    <!-- Cookie同意條款 -->
    <div id="cookie-consent" class="cookie-consent" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-desc">
        <div class="cookie-consent__content">
            <h2 id="cookie-title" class="sr-only">Cookie 使用同意</h2>
            <p id="cookie-desc">本網站使用Cookie來改善您的瀏覽體驗。繼續使用本網站，即表示您同意我們的<a href="/cookies-policy/">Cookies政策</a>。</p>
            <button id="cookie-accept" class="btn btn-primary" aria-label="接受Cookie使用條款">接受</button>
        </div>
    </div>
    
    <!-- Main JavaScript -->
    {{ $script := resources.Get "js/main.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $script.RelPermalink }}"></script>
    
    <!-- Component JavaScript -->
    <!-- 載入狀態系統 -->
    {{ $loadingScript := resources.Get "js/components/loading.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $loadingScript.RelPermalink }}"></script>
    
    {{ if or (eq .Section "articles") (eq .Section "videos") (eq .Section "faq") (eq .Section "downloads") }}
    {{ $searchScript := resources.Get "js/components/search.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $searchScript.RelPermalink }}"></script>
    {{ end }}
    
    {{ if and (eq .Section "articles") (eq .Kind "page") }}
    {{ $tocScript := resources.Get "js/components/toc.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $tocScript.RelPermalink }}"></script>
    {{ end }}
    
    <!-- Custom JavaScript -->
    {{ range .Site.Params.customJS }}
    <script src="{{ . | relURL }}"></script>
    {{ end }}
</body>
</html>