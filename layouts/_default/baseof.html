<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "zh-tw" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ with .Params.seo_title }}{{ . }}{{ else }}{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}{{ end }}</title>
    <meta name="description" content="{{ with .Params.seo_description }}{{ . }}{{ else }}{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . | plainify | safeHTML | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}{{ end }}">
    
    <!-- SEO Meta Tags -->
    {{ if .Params.seo_title }}<meta property="og:title" content="{{ .Params.seo_title }}">{{ else }}<meta property="og:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta property="og:description" content="{{ .Params.seo_description }}">{{ else }}<meta property="og:description" content="{{ .Description }}">{{ end }}
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    {{ with .Params.cover }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    {{ if .Params.seo_title }}<meta name="twitter:title" content="{{ .Params.seo_title }}">{{ else }}<meta name="twitter:title" content="{{ .Title }} - {{ .Site.Title }}">{{ end }}
    {{ if .Params.seo_description }}<meta name="twitter:description" content="{{ .Params.seo_description }}">{{ else }}<meta name="twitter:description" content="{{ .Description }}">{{ end }}
    {{ with .Params.cover }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}
    
    <!-- Favicon -->
    <link rel="icon" sizes="16x16" href="{{ $.Site.Params.favicon.icon16 | default "/uploads/images/general/general-favicon-16x16.png" }}">
    <link rel="icon" sizes="32x32" href="{{ $.Site.Params.favicon.icon32 | default "/uploads/images/general/general-favicon-32x32.png" }}">
    <link rel="icon" href="{{ $.Site.Params.favicon.ico | default "/uploads/images/general/general-favicon.ico" }}">
    <link rel="apple-touch-icon" href="{{ $.Site.Params.favicon.ico | default "/uploads/images/general/general-favicon.ico" }}">

    <!-- Preload local fonts -->
    <link rel="preload" as="font" type="font/woff2" href="/fonts/kaleko-105-bold.woff2" crossorigin>
    <link rel="preload" as="font" type="font/woff2" href="/fonts/TouchMeSans-PetiteRegular.woff2" crossorigin>
    
    {{ $perf := .Site.Params.performance_mode | default false }}
    {{ if not $perf }}
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
      {{ if eq .Section "videos" }}
      <link rel="preconnect" href="https://www.youtube.com" crossorigin>
      <link rel="preconnect" href="https://i.ytimg.com" crossorigin>
      {{ end }}
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
      <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
      </noscript>
    {{ end }}

    <!-- Preload LCP image on homepage -->
    {{ if .IsHome }}
    <link rel="preload" as="image" href="/uploads/images/general/general-accounting-desk.avif" fetchpriority="high">
    {{ end }}
    
    {{ if not $perf }}
      <!-- Font Awesome -->
      <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" media="print" onload="this.media='all'">
    {{ end }}
    
    <!-- Main CSS + Critical CSS inline（首頁抽取） -->
    {{ $style := resources.Get "scss/main.scss" | css.Sass | resources.Minify | resources.Fingerprint }}
    {{ if .IsHome }}
    <style>
      /* Critical CSS (首頁 Above-the-fold 簡版) */
      body{background:#0A0A0A;color:#fff;font-family:"Inter","Noto Sans TC",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.7;margin:0;padding-top:64px}
      .site-header{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center}
      .site-header__container{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 2rem}
      .site-header__title{font-weight:700}
      .hero-split{padding:4rem 0 3rem;background:radial-gradient(1200px 600px at 85% -100px,rgba(255,255,255,.06),transparent),linear-gradient(180deg,rgba(255,255,255,.03),transparent 60%)}
      .hero-split__container{display:grid;grid-template-columns:1.2fr 1fr;gap:2.5rem;align-items:center;max-width:1200px;margin:0 auto;padding:0 2rem}
      .hero-split__title{font-size:2.5rem;margin:0 0 1rem}
      .hero-split__subtitle{color:#D1D5DB;margin:0 0 1.5rem;max-width:56ch}
      .hero-split__actions{display:flex;gap:.75rem}
      .btn-cta-primary,.btn-cta-secondary{display:inline-flex;align-items:center;justify-content:center;padding:1rem 2rem;border-radius:12px;font-weight:500;text-decoration:none}
      .btn-cta-primary{background:#000;color:#fff}
      .btn-cta-secondary{background:#00B900;color:#fff}
      .hero-split__media img{width:100%;height:auto;border-radius:12px}
      @media(max-width:1024px){.hero-split__container{grid-template-columns:1fr}}
    </style>
    {{ end }}
    <link rel="preload" as="style" href="{{ $style.RelPermalink }}">
    <link rel="stylesheet" href="{{ $style.RelPermalink }}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{{ $style.RelPermalink }}"></noscript>
    
    <!-- Custom CSS -->
    {{ range .Site.Params.customCSS }}
    <link rel="stylesheet" href="{{ . | relURL }}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{{ . | relURL }}"></noscript>
    {{ end }}
    
    <!-- Google Analytics 延後載入（依 Cookie 同意）由 analytics.js 控制 -->
    
    <!-- 結構化資料 Schema.org -->
    {{ partial "head/schema.html" . }}
</head>
<body class="{{ if .IsHome }}home{{ else }}{{ .Section }}{{ end }}" data-section="{{ .Section }}" data-kind="{{ .Kind }}" data-template="custom-baseof" data-recaptcha-site-key="{{ .Site.Params.recaptcha.site_key }}" data-ga-id="{{ .Site.Params.ga_id }}">
    <!-- 無障礙跳過連結 -->
    {{ partial "skip-links.html" . }}
    
    <!-- 無障礙ARIA標籤 -->
    {{ partial "aria-labels.html" . }}
    
    <!-- 頁面載入進度條由JavaScript動態創建 -->
    
    <!-- 導航欄 -->
    <header>
        <nav id="main-navigation" aria-labelledby="aria-nav-desc">
            {{ partial "header.html" . }}
        </nav>
    </header>
    
    <!-- 主要內容 -->
    <main id="main-content" aria-labelledby="aria-main-desc">
        {{ block "main" . }}{{ end }}
    </main>
    
    <!-- 側邊欄區塊由各頁面模板自行處理 -->

    <!-- 全站 CTA：統一放在 SEO 區塊之上，避免各模板重複與位置錯誤 -->
    {{/* 規則：首頁與以下 section 顯示 CTA；排除 appointment（避免自我重複） */}}
    {{ $ctaSections := slice "services" "articles" "videos" "faq" "downloads" "about" "contact" }}
    {{ if and (ne .Section "appointment") (or .IsHome (in $ctaSections .Section)) }}
    {{ partial "shared/dual-cta.html" . }}
    {{ end }}

    <!-- SEO區塊 -->
    {{ partial "seo-content.html" . }}
    
    <!-- 頁腳 -->
    <footer id="footer" aria-labelledby="aria-footer-desc">
        {{ partial "footer.html" . }}
    </footer>
    
    <!-- Cookie同意條款 -->
    <div id="cookie-consent" class="cookie-consent" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-desc">
        <div class="cookie-consent__content">
            <h2 id="cookie-title" class="sr-only">Cookie 使用同意</h2>
            <p id="cookie-desc">本網站使用Cookie來改善您的瀏覽體驗。繼續使用本網站，即表示您同意我們的<a href="/cookies-policy/">Cookies政策</a>。</p>
            <button id="cookie-accept" class="btn btn-secondary" aria-label="接受Cookie使用條款">接受</button>
        </div>
    </div>
    
    <!-- 浮動按鈕組 -->
    <div class="floating-buttons">
        <!-- 社群媒體按鈕組 -->
        <div class="social-buttons">
            <div class="social-buttons__menu">
                {{ with .Site.Params.widgets.social.line }}
                <a href="https://line.me/R/ti/p/{{ . }}" class="social-button line" target="_blank" rel="noopener" aria-label="LINE">
                    <img src="/uploads/icons/social/line.svg" width="22" height="22" alt="LINE" />
                </a>
                {{ end }}
                {{ with .Site.Params.widgets.social.threads }}
                <a href="https://www.threads.net/@{{ . }}" class="social-button threads" target="_blank" rel="noopener" aria-label="Threads">
                    <img src="/uploads/icons/social/threads.svg" width="22" height="22" alt="Threads" />
                </a>
                {{ end }}
                {{ with .Site.Params.widgets.social.instagram }}
                <a href="https://instagram.com/{{ . }}" class="social-button instagram" target="_blank" rel="noopener" aria-label="Instagram">
                    <img src="/uploads/icons/social/instagram.svg" width="22" height="22" alt="Instagram" />
                </a>
                {{ end }}
                {{ with .Site.Params.widgets.social.email }}
                <a href="mailto:{{ . }}" class="social-button email" aria-label="Email">
                    <img src="/uploads/icons/social/email.svg" width="22" height="22" alt="Email" />
                </a>
                {{ end }}
            </div>
        </div>
        
        <!-- 回到頂端按鈕 (獨立於社群媒體按鈕下方) -->
        <button id="back-to-top" class="back-to-top" aria-label="回到頂端">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>
    
    <!-- Main JavaScript -->
    {{ $script := resources.Get "js/main.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $script.RelPermalink }}" defer></script>
    
    <!-- reCAPTCHA 僅在需要頁面載入（預約、或含留言的內容頁） -->
    {{ if or (eq .Section "appointment") (and (in (slice "articles" "faq" "downloads") .Section) (eq .Kind "page")) }}
    <script src="https://www.google.com/recaptcha/api.js?render={{ .Site.Params.recaptcha.site_key }}" defer></script>
    {{ end }}
    
    <!-- Component JavaScript -->
    <!-- 載入狀態系統 -->
    {{ $loadingScript := resources.Get "js/components/loading.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $loadingScript.RelPermalink }}" defer></script>
    
    <!-- 回到頂端按鈕 -->
    {{ $backToTopScript := resources.Get "js/components/back-to-top.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $backToTopScript.RelPermalink }}" defer></script>

    <!-- Header滾動效果 -->
    {{ $headerScrollScript := resources.Get "js/components/headerScroll.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $headerScrollScript.RelPermalink }}" defer></script>

    <!-- 行動版導覽 -->
    {{ $mobileNavScript := resources.Get "js/components/mobileNav.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $mobileNavScript.RelPermalink }}" defer></script>

    <!-- 鍵盤導航（無障礙） -->
    {{ $keyboardNav := resources.Get "js/components/keyboard-nav.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $keyboardNav.RelPermalink }}" defer></script>

    <!-- 頁腳摺疊 -->
    {{ $footerCollapseScript := resources.Get "js/components/footerCollapse.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $footerCollapseScript.RelPermalink }}" defer></script>
    {{ $videoFallbackScript := resources.Get "js/components/video-fallback.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $videoFallbackScript.RelPermalink }}" defer></script>
    {{ $businessStatus := resources.Get "js/components/business-status.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $businessStatus.RelPermalink }}" defer></script>
    {{ $analytics := resources.Get "js/components/analytics.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $analytics.RelPermalink }}" defer></script>
    {{ $imageOptimization := resources.Get "js/components/image-optimization.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $imageOptimization.RelPermalink }}" defer></script>
    
    <!-- Hero 輪播功能 & 首頁進場動畫 (僅首頁) -->
    {{ if .IsHome }}
    {{ $heroCarouselScript := resources.Get "js/components/hero-carousel.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $heroCarouselScript.RelPermalink }}" defer></script>
    {{ $inviewStatsScript := resources.Get "js/components/inview-stats.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $inviewStatsScript.RelPermalink }}" defer></script>
    {{ $tnCarousel := resources.Get "js/components/testimonials-carousel.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $tnCarousel.RelPermalink }}" defer></script>
    {{ end }}
    
    <!-- About 圖片進場傾斜轉正效果 -->
    {{ if eq .Section "about" }}
    {{ $inviewTiltScript := resources.Get "js/components/inview-photo-tilt.js" | resources.Minify | resources.Fingerprint }}
    <script type="module" src="{{ $inviewTiltScript.RelPermalink }}" defer></script>
    {{ end }}
    
    
    
    {{ if and (eq .Section "articles") (eq .Kind "page") }}
    {{ $tocScript := resources.Get "js/components/toc.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $tocScript.RelPermalink }}" defer></script>
    {{ end }}
    
    <!-- Custom JavaScript -->
    {{ range .Site.Params.customJS }}
    <script src="{{ . | relURL }}"></script>
    {{ end }}
</body>
</html>