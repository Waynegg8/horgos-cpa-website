{{ define "main" }}
<main class="container single-wrapper" style="padding-top:80px;">
  <div class="single-content">
    <h1>{{ .Title }}</h1>
    {{/* 顯示文章元資訊：日期與分類 */}}
    <div class="post-meta">
      {{ with .Date }}<span class="date">{{ . | dateFormat "2006-01-02" }}</span>{{ end }}
      {{ with .Params.categories }}
      <span class="categories">
        {{ range . }}
          <a href="{{ (print "/categories/" (urlize .) "/") | relURL }}" class="tag">{{ . }}</a>
        {{ end }}
      </span>
      {{ end }}
    </div>
    {{ .Content }}
    {{/* 上一篇/下一篇導覽：僅在文章、常見問題、影音、下載頁顯示；若超出邊界則採用首尾輪循 */}}
    {{ if or (eq .Section "articles") (eq .Section "faq") (eq .Section "videos") (eq .Section "downloads") }}
    {{/* 決定上一頁與下一頁邏輯：使用同 Section 中的文章形成環狀輪循，確保永遠有上一筆與下一筆 */}}
    {{ $sectionPages := where .Site.RegularPages "Section" .Section }}
    {{ $prev := .PrevInSection }}
    {{ $next := .NextInSection }}
    {{/* 若上一頁為空或等於自身，則取本 Section 最後一篇作為上一頁 */}}
    {{ if or (not $prev) (eq $prev.RelPermalink .RelPermalink) }}
      {{ $prev = (index (last 1 $sectionPages) 0) }}
    {{ end }}
    {{/* 若下一頁為空或等於自身，則取本 Section 第一篇作為下一頁 */}}
    {{ if or (not $next) (eq $next.RelPermalink .RelPermalink) }}
      {{ $next = (index $sectionPages 0) }}
    {{ end }}
    <nav class="prev-next">
      {{ if and $prev (ne $prev.RelPermalink .RelPermalink) }}<a href="{{ $prev.RelPermalink }}" class="prev-article">上一篇：{{ $prev.Title }}</a>{{ end }}
      {{ if and $next (ne $next.RelPermalink .RelPermalink) }}<a href="{{ $next.RelPermalink }}" class="next-article">下一篇：{{ $next.Title }}</a>{{ end }}
    </nav>
    {{ end }}
    <!-- SEO 區塊 -->
    {{ partial "seo.html" . }}
  </div>
  <aside class="single-sidebar">
    <div class="sidebar-block">
      <h3>搜尋</h3>
      <input type="text" class="sidebar-search" placeholder="搜尋{{ .Title }}..." aria-label="搜尋...">
    </div>
    <div class="sidebar-block">
      <h3>分類</h3>
      <ul class="sidebar-list">
        {{ with .Params.categories }}
        {{ range . }}
        <li><a href="{{ (print "/categories/" (urlize .) "/") | relURL }}">{{ . }}</a></li>
        {{ end }}
        {{ end }}
      </ul>
    </div>
    <div class="sidebar-block">
      <h3>系列</h3>
      <ul class="sidebar-list">
        {{ with .Params.series }}
        {{ range . }}
        <li><a href="{{ (print "/series/" (urlize .) "/") | relURL }}">{{ . }}</a></li>
        {{ end }}
        {{ end }}
      </ul>
    </div>
    <div class="sidebar-block">
      <h3>關鍵字</h3>
      <ul class="sidebar-list">
        {{ with .Params.tags }}
        {{ range . }}
        <li><a href="{{ (print "/tags/" (urlize .) "/") | relURL }}">{{ . }}</a></li>
        {{ end }}
        {{ end }}
      </ul>
    </div>
    {{ if eq .Section "articles" }}
    <div class="sidebar-block">
      <h3>目錄</h3>
      <div class="table-of-contents">
        {{ .TableOfContents }}
      </div>
    </div>
    {{ end }}
  </aside>
</main>
{{ end }}