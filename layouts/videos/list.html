{{ define "main" }}
<div class="container">
  <div class="two-column">
    <div class="two-column__main">
      <!-- 搜索框 -->
      {{ partial "search/list-search.html" . }}
      
      <!-- 頁面標題和內容 -->
      <header class="page-header">
        <h1 class="page-header__title">{{ .Title }}</h1>
        {{ with .Content }}
        <div class="page-header__description">{{ . }}</div>
        {{ end }}
      </header>
      
      <!-- 影片分類卡片 -->
      {{ if eq .RelPermalink "/videos/" }}
      {{ partial "videos/video-categories.html" . }}
      {{ end }}
      
      <!-- 分類篩選 -->
      <div class="category-nav card-style">
        <div class="category-nav__links">
          <a href="{{ .RelPermalink }}" class="category-nav__link {{ if eq .RelPermalink .CurrentSection.RelPermalink }}active{{ end }}">
            <i class="fas fa-th-large"></i>
            <span>全部影片</span>
          </a>
          {{ range .Sections }}
          <a href="{{ .RelPermalink }}" class="category-nav__link {{ if eq .RelPermalink $.Permalink }}active{{ end }}">
            <i class="fas fa-play-circle"></i>
            <span>{{ .Title }}</span>
          </a>
          {{ end }}
        </div>
      </div>
      
      <!-- 影片列表 -->
      <div class="videos-list">
        {{ $paginator := .Paginate (where .Pages "Type" "videos") 10 }}
        {{ range $paginator.Pages }}
          <a href="{{ .RelPermalink }}" class="card-style card-clickable">
            <div class="card-horizontal">
              <div class="card-horizontal__image">
                {{ with .Params.thumbnail }}
                <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                {{ else }}
                <img src="/uploads/images/general/general-default.jpg" alt="{{ $.Title }}" loading="lazy">
                {{ end }}
                <div class="video-duration">
                  {{ with .Params.duration }}{{ . }}{{ else }}--:--{{ end }}
                </div>
              </div>
              <div class="card-horizontal__content">
                <h2 class="video-title">{{ $.Title }}</h2>
                <div class="video-meta">
                  <span class="video-meta__item"><i class="fas fa-calendar-alt"></i> {{ $.Date.Format "2006-01-02" }}</span>
                  <span class="video-meta__item"><i class="fas fa-play-circle"></i> 影片</span>
                  {{ with $.Params.series }}
                  <span class="video-meta__item"><i class="fas fa-bookmark"></i> {{ . }}</span>
                  {{ end }}
                </div>
                <p class="video-description">{{ $.Summary | truncate 100 }}</p>
              </div>
            </div>
          </a>
        {{ end }}
      </div>
    
    {{ if gt .Paginator.TotalPages 1 }}
    <nav class="pagination" role="navigation" aria-label="分頁導航">
        <div class="pagination__info">
            第 {{ .Paginator.PageNumber }} / {{ .Paginator.TotalPages }} 頁，共 {{ .Paginator.TotalNumberOfElements }} 部影片
        </div>
        <div class="pagination__controls">
            {{ if .Paginator.HasPrev }}
                <a href="{{ .Paginator.Prev.URL }}" class="pagination__link pagination__link--prev" aria-label="上一頁">
                    <i class="fas fa-chevron-left"></i>
                    上一頁
                </a>
            {{ end }}
            
            {{ range .Paginator.Pagers }}
                {{ if eq . $.Paginator }}
                    <span class="pagination__link pagination__link--current" aria-current="page">{{ .PageNumber }}</span>
                {{ else }}
                    <a href="{{ .URL }}" class="pagination__link">{{ .PageNumber }}</a>
                {{ end }}
            {{ end }}
            
            {{ if .Paginator.HasNext }}
                <a href="{{ .Paginator.Next.URL }}" class="pagination__link pagination__link--next" aria-label="下一頁">
                    下一頁
                    <i class="fas fa-chevron-right"></i>
                </a>
            {{ end }}
        </div>
    </nav>
      {{ end }}
    </div>
    
    <!-- 側邊欄 -->
    <div class="two-column__sidebar">
      {{ partial "sidebar/videos-sidebar.html" . }}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  const videosList = document.querySelector('.videos-list');
  
  // 簡化版前端搜尋功能
  searchInput.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    
    if (query.length < 2) {
      searchResults.style.display = 'none';
      videosList.style.display = 'block';
      return;
    }
    
    // 這裡將來整合 Fuse.js 搜尋
    // 目前先實現簡單的前端篩選
    const videos = document.querySelectorAll('.video-card');
    let results = [];
    
    videos.forEach(video => {
      const title = video.querySelector('.video-title').textContent.toLowerCase();
      const description = video.querySelector('.video-description').textContent.toLowerCase();
      
      if (title.includes(query) || description.includes(query)) {
        results.push(video.cloneNode(true));
      }
    });
    
    if (results.length > 0) {
      searchResults.innerHTML = '';
      results.forEach(result => {
        searchResults.appendChild(result);
      });
      searchResults.style.display = 'block';
      videosList.style.display = 'none';
    } else {
      searchResults.innerHTML = '<div class="no-results">沒有找到相關影片</div>';
      searchResults.style.display = 'block';
      videosList.style.display = 'none';
    }
  });
});
</script>
{{ end }}