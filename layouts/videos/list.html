{{ define "main" }}
<!-- 統一頁首區塊（置於雙欄之外，確保側邊欄從內容處開始） -->
<div class="page-header">
  <div class="container">
    <div class="page-header__content">
      <h1 class="page-header__title">{{ .Title }}</h1>
      <div class="page-header__line"></div>
      {{ with .Description }}<p class="page-header__description">{{ . }}</p>{{ end }}
    </div>
  </div>
</div>

<div class="container">
  <div class="two-column">
    <div class="two-column__main">
      <!-- 列表頁搜尋（統一樣式，作為主內容第一個項目） -->
      <div class="list-search" role="search" aria-label="影片搜尋">
        <label class="search-field">
          <i class="fas fa-search search-icon" aria-hidden="true"></i>
          <input id="video-search-input" class="search-input" type="search" placeholder="搜尋影片標題或摘要..." aria-label="搜尋影片" />
        </label>
      </div>
      
      <!-- 分類篩選 -->
      <div class="category-nav card-style">
        <div class="category-nav__links">
          <a href="{{ .RelPermalink }}" class="category-nav__link {{ if eq .RelPermalink .CurrentSection.RelPermalink }}active{{ end }}">
            <i class="fas fa-th-large"></i>
            <span>全部影片</span>
          </a>
          {{ range .Sections }}
          <a href="{{ .RelPermalink }}" class="category-nav__link {{ if eq .RelPermalink $.Permalink }}active{{ end }}">
            <i class="fas fa-play-circle"></i>
            <span>{{ .Title }}</span>
          </a>
          {{ end }}
        </div>
      </div>
      
      <!-- 影片列表 -->
      <div class="videos-list" id="videos-list">
        {{ $pages := .RegularPages }}
        {{ if eq .Kind "section" }}{{ $pages = .RegularPagesRecursive }}{{ end }}
        {{ $paginator := .Paginate $pages 10 }}
        {{ range $paginator.Pages }}
          {{ $p := . }}
          <div class="video-card" data-title="{{ .Title }}" data-description="{{ .Summary }}">
            <a href="{{ .RelPermalink }}" class="video-card-link">
              <div class="video-thumbnail">
                {{ with .Params.thumbnail }}
                <img src="{{ . }}" alt="{{ $p.Title }}" loading="lazy">
                {{ else }}
                <img src="/uploads/images/general/general-default.jpg" alt="{{ $p.Title }}" loading="lazy">
                {{ end }}
                <div class="video-duration-badge">
                  {{ with .Params.duration }}{{ . }}{{ else }}--:--{{ end }}
                </div>
              </div>
              <div class="video-card-content">
                <h2 class="video-title">{{ .Title }}</h2>
                <div class="video-meta">
                  <span class="video-meta__item"><i class="fas fa-calendar-alt"></i> {{ .Date.Format "2006-01-02" }}</span>
                  <span class="video-meta__item"><i class="fas fa-play-circle"></i> 影片</span>
                  {{ with .Params.series }}
                  <span class="video-meta__item"><i class="fas fa-bookmark"></i> {{ . }}</span>
                  {{ end }}
                </div>
                <p class="video-description">{{ .Summary | plainify | truncate 100 }}</p>
              </div>
            </a>
          </div>
        {{ end }}
      </div>
    
    {{ if gt .Paginator.TotalPages 1 }}
    <nav class="pagination" role="navigation" aria-label="分頁導航">
        <div class="pagination__info">
            第 {{ .Paginator.PageNumber }} / {{ .Paginator.TotalPages }} 頁，共 {{ .Paginator.TotalNumberOfElements }} 部影片
        </div>
        <div class="pagination__controls">
            {{ if .Paginator.HasPrev }}
                <a href="{{ .Paginator.Prev.URL }}" class="pagination__link pagination__link--prev" aria-label="上一頁">
                    <i class="fas fa-chevron-left"></i>
                    上一頁
                </a>
            {{ end }}
            
            {{ range .Paginator.Pagers }}
                {{ if eq . $.Paginator }}
                    <span class="pagination__link pagination__link--current" aria-current="page">{{ .PageNumber }}</span>
                {{ else }}
                    <a href="{{ .URL }}" class="pagination__link">{{ .PageNumber }}</a>
                {{ end }}
            {{ end }}
            
            {{ if .Paginator.HasNext }}
                <a href="{{ .Paginator.Next.URL }}" class="pagination__link pagination__link--next" aria-label="下一頁">
                    下一頁
                    <i class="fas fa-chevron-right"></i>
                </a>
            {{ end }}
        </div>
    </nav>
      {{ end }}
    </div>
    
    <!-- 側邊欄 -->
    <div class="two-column__sidebar">
      {{ partial "sidebar/videos-sidebar.html" . }}
    </div>
  </div>
</div>

<!-- CTA 不在本模板插入，統一由 base 模板在 SEO 區塊上方輸出，以避免重複 -->

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('video-search-input');
    const cards = document.querySelectorAll('.videos-list .video-card');
    if (!searchInput) return;
    const norm = s => (s || '').toLowerCase();
    searchInput.addEventListener('input', function(){
      const q = norm(this.value);
      cards.forEach(card => {
        const title = norm(card.dataset.title);
        const desc = norm(card.dataset.description);
        const match = !q || title.includes(q) || desc.includes(q);
        card.style.display = match ? 'block' : 'none';
      });
    });
  });
  </script>
{{ end }}