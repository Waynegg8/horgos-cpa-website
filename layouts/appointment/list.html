{{ define "main" }}
<div class="container">
    <div class="appointment-container">
        <div class="appointment-header">
            <h1>{{ .Title }}</h1>
            <div class="appointment-description">{{ .Content }}</div>
        </div>
        
        <!-- 預約表單 -->
        <div class="appointment-form-container">
            <form id="appointment-form" class="appointment-form" aria-labelledby="form-heading" novalidate>
                <h2 id="form-heading" class="sr-only">預約諮詢表單</h2>
                <p class="form-description">請填寫以下表單以預約我們的專業諮詢服務。標示 <span class="required">*</span> 為必填欄位。</p>
                
                <div class="form-group">
                    <label for="name" id="name-label">姓名 <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required minlength="2" maxlength="20" aria-required="true" aria-labelledby="name-label" aria-describedby="name-error">
                    <div class="error-message" id="name-error" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="email" id="email-label">電子郵件 <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required aria-required="true" aria-labelledby="email-label" aria-describedby="email-error">
                    <div class="error-message" id="email-error" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="line" id="line-label">LINE ID <span class="required">*</span></label>
                    <input type="text" id="line" name="line" required aria-required="true" aria-labelledby="line-label" aria-describedby="line-error">
                    <div class="error-message" id="line-error" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="phone" id="phone-label">聯絡電話 <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" required pattern="[0-9\-\+]{8,15}" aria-required="true" aria-labelledby="phone-label" aria-describedby="phone-help phone-error">
                    <div class="error-message" id="phone-error" aria-live="polite"></div>
                    <small id="phone-help">請輸入有效的台灣手機或市話號碼</small>
                </div>
                
                <fieldset class="form-group">
                    <legend>諮詢服務類型 <span class="required">*</span></legend>
                    <div class="service-buttons" role="radiogroup" aria-describedby="service-error">
                        <input type="radio" id="service-business" name="service" value="工商登記" required aria-required="true">
                        <label for="service-business" class="service-button">工商登記</label>
                        
                        <input type="radio" id="service-tax" name="service" value="稅務申報" required aria-required="true">
                        <label for="service-tax" class="service-button">稅務申報</label>
                        
                        <input type="radio" id="service-audit" name="service" value="財稅簽證" required aria-required="true">
                        <label for="service-audit" class="service-button">財稅簽證</label>
                        
                        <input type="radio" id="service-consulting" name="service" value="諮詢服務" required aria-required="true">
                        <label for="service-consulting" class="service-button">諮詢服務</label>
                        
                        <input type="radio" id="service-other" name="service" value="其他服務" required aria-required="true">
                        <label for="service-other" class="service-button">其他服務</label>
                    </div>
                    <div class="error-message" id="service-error" aria-live="polite"></div>
                </fieldset>
                
                <div class="form-group">
                    <label for="content" id="content-label">諮詢內容</label>
                    <textarea id="content" name="content" rows="5" aria-labelledby="content-label" aria-describedby="content-help"></textarea>
                    <small id="content-help">請簡要描述您的諮詢需求，以便我們更好地為您安排合適的專業人員</small>
                </div>
                
                <div class="form-group privacy-agreement">
                    <input type="checkbox" id="privacy" name="privacy" required aria-required="true" aria-describedby="privacy-error">
                    <label for="privacy">我已閱讀並同意<a href="/privacy-policy/" target="_blank" rel="noopener">隱私權政策</a>，並同意提供個人資料用於預約諮詢服務 <span class="required">*</span></label>
                    <div class="error-message" id="privacy-error" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <button type="submit" id="submit-btn" class="submit-button">送出預約</button>
                    <div id="form-status" class="form-status" aria-live="assertive"></div>
                </div>
            </form>
        </div>
        
        <!-- 雙CTA行動呼籲區域 -->
        <div class="dual-cta-section">
            <div class="btn-group">
                <a href="/appointment/" class="btn btn-primary btn-lg">立即預約諮詢</a>
                <a href="https://line.me/R/ti/p/@hugo.accounting" target="_blank" rel="noopener" class="btn btn-secondary btn-lg btn-icon">
                    <i class="fab fa-line"></i>加入Line諮詢
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('appointment-form');
  const submitBtn = document.getElementById('submit-btn');
  const formStatus = document.getElementById('form-status');
  
  // 服務按鈕點擊效果
  const serviceButtons = document.querySelectorAll('.service-button');
  serviceButtons.forEach(button => {
    button.addEventListener('click', function() {
      const radioId = this.getAttribute('for');
      const radio = document.getElementById(radioId);
      
      // 更新所有按鈕狀態
      serviceButtons.forEach(btn => {
        btn.classList.remove('selected');
        btn.setAttribute('aria-pressed', 'false');
      });
      
      // 設置當前選中狀態
      this.classList.add('selected');
      this.setAttribute('aria-pressed', 'true');
      
      // 選中對應的單選按鈕
      if (radio) {
        radio.checked = true;
        radio.focus();
      }
    });
    
    // 初始化無障礙屬性
    button.setAttribute('aria-pressed', 'false');
    button.setAttribute('role', 'button');
  });
  
  // 鍵盤無障礙支持
  serviceButtons.forEach(button => {
    button.addEventListener('keydown', function(e) {
      // 按下空格或回車鍵時觸發點擊
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        button.click();
      }
    });
  });
  
  // 表單驗證與提交
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    let isValid = true;
    
    // 重置錯誤訊息
    const errorMessages = document.querySelectorAll('.error-message');
    errorMessages.forEach(el => el.textContent = '');
    
    // 移除所有錯誤狀態
    const formInputs = form.querySelectorAll('input, textarea, select');
    formInputs.forEach(input => {
      input.classList.remove('is-invalid');
      input.setAttribute('aria-invalid', 'false');
    });
    
    // 驗證姓名
    const name = document.getElementById('name').value.trim();
    if (name.length < 2 || name.length > 20) {
      const errorEl = document.getElementById('name-error');
      errorEl.textContent = '姓名長度應為2-20個字元';
      document.getElementById('name').classList.add('is-invalid');
      document.getElementById('name').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 驗證電子郵件
    const email = document.getElementById('email').value.trim();
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
      const errorEl = document.getElementById('email-error');
      errorEl.textContent = '請輸入有效的電子郵件地址';
      document.getElementById('email').classList.add('is-invalid');
      document.getElementById('email').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 驗證LINE ID
    const line = document.getElementById('line').value.trim();
    if (line.length < 1) {
      const errorEl = document.getElementById('line-error');
      errorEl.textContent = '請輸入您的LINE ID';
      document.getElementById('line').classList.add('is-invalid');
      document.getElementById('line').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 驗證電話
    const phone = document.getElementById('phone').value.trim();
    const phonePattern = /^[0-9\-\+]{8,15}$/;
    if (!phonePattern.test(phone)) {
      const errorEl = document.getElementById('phone-error');
      errorEl.textContent = '請輸入有效的電話號碼';
      document.getElementById('phone').classList.add('is-invalid');
      document.getElementById('phone').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 驗證服務類型
    const service = document.querySelector('input[name="service"]:checked');
    if (!service) {
      const errorEl = document.getElementById('service-error');
      errorEl.textContent = '請選擇諮詢服務類型';
      document.querySelector('.service-buttons').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 驗證隱私權同意
    const privacy = document.getElementById('privacy').checked;
    if (!privacy) {
      const errorEl = document.getElementById('privacy-error');
      errorEl.textContent = '請同意隱私權政策';
      document.getElementById('privacy').classList.add('is-invalid');
      document.getElementById('privacy').setAttribute('aria-invalid', 'true');
      isValid = false;
    }
    
    // 如果表單無效，聚焦到第一個錯誤欄位
    if (!isValid) {
      const firstError = form.querySelector('.is-invalid');
      if (firstError) {
        firstError.focus();
      }
      return;
    }
    
    // 顯示載入狀態
    submitBtn.disabled = true;
    submitBtn.textContent = '送出中...';
    submitBtn.setAttribute('aria-busy', 'true');
    formStatus.textContent = '';
    formStatus.classList.remove('success', 'error');
    
    // 模擬表單提交
    setTimeout(function() {
      // 模擬成功提交
      submitBtn.disabled = false;
      submitBtn.textContent = '送出預約';
      submitBtn.setAttribute('aria-busy', 'false');
      formStatus.textContent = '預約申請已成功送出，我們將盡快與您聯繫確認詳情。';
      formStatus.classList.add('success');
      formStatus.setAttribute('role', 'alert');
      
      // 重置表單
      form.reset();
      serviceButtons.forEach(btn => {
        btn.classList.remove('selected');
        btn.setAttribute('aria-pressed', 'false');
      });
      
      // 聚焦到成功訊息
      formStatus.focus();
    }, 1500);
  });
});
</script>

<style>
.appointment-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem 0;
}

.appointment-header {
  margin-bottom: 2rem;
}

.appointment-form-container {
  background-color: #f8f9fa;
  border-radius: 8px;
  padding: 2rem;
  margin: 2rem 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="tel"],
.form-group textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #E5E7EB;
  border-radius: 4px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
  border-color: #204B6E;
  outline: none;
  box-shadow: 0 0 0 3px rgba(32, 75, 110, 0.1);
}

.form-group small {
  display: block;
  margin-top: 0.25rem;
  color: #6B7280;
  font-size: 0.875rem;
}

.required {
  color: #EF4444;
}

.service-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.service-buttons input[type="radio"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.service-button {
  display: inline-block;
  padding: 0.5rem 1rem;
  background-color: #fff;
  border: 1px solid #E5E7EB;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.service-button:hover {
  background-color: #F3F4F6;
}

.service-button.selected {
  background-color: #204B6E;
  color: white;
  border-color: #204B6E;
}

.privacy-agreement {
  display: flex;
  align-items: flex-start;
}

.privacy-agreement input[type="checkbox"] {
  margin-top: 0.25rem;
  margin-right: 0.5rem;
}

.submit-button {
  display: inline-block;
  padding: 0.75rem 2rem;
  background-color: #204B6E;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.submit-button:hover {
  background-color: #2C5F7F;
}

.submit-button:disabled {
  background-color: #9CA3AF;
  cursor: not-allowed;
}

.error-message {
  color: #EF4444;
  font-size: 0.875rem;
  margin-top: 0.25rem;
  min-height: 1.25rem;
}

.form-status {
  margin-top: 1rem;
  padding: 0.75rem;
  border-radius: 4px;
  font-weight: 500;
}

.form-status.success {
  background-color: #D1FAE5;
  color: #065F46;
}

.form-status.error {
  background-color: #FEE2E2;
  color: #B91C1C;
}

/* 無障礙樣式 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.form-description {
  margin-bottom: 1.5rem;
}

input:focus, 
textarea:focus, 
select:focus, 
button:focus {
  outline: 2px solid #204B6E;
  outline-offset: 2px;
}

/* 雙CTA區域樣式 */
.dual-cta-section {
  margin-top: 3rem;
  padding: 2rem;
  background-color: #f8f9fa;
  border-radius: 8px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dual-cta-section .btn-group {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
}

@media (max-width: 768px) {
  .appointment-container {
    padding: 1rem 0;
  }
  
  .appointment-form-container {
    padding: 1.5rem;
    margin: 1.5rem 0;
  }
  
  .form-group {
    margin-bottom: 1.25rem;
  }
  
  .service-buttons {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .service-button {
    width: 100%;
    text-align: center;
    padding: 0.75rem;
  }
  
  .dual-cta-section {
    padding: 1.5rem;
    margin-top: 2rem;
  }
  
  .dual-cta-section .btn-group {
    flex-direction: column;
    gap: 1rem;
  }
  
  .dual-cta-section .btn {
    width: 100%;
  }
  
  /* 改善觸控體驗 */
  input, 
  textarea, 
  select, 
  button, 
  .service-button, 
  .btn {
    min-height: 44px;
  }
  
  /* 增加表單元素間距，改善觸控操作 */
  .form-group label,
  .form-group small {
    font-size: 0.9rem;
  }
  
  .privacy-agreement label {
    font-size: 0.85rem;
  }
}

/* 特小螢幕裝置優化 */
@media (max-width: 480px) {
  .appointment-header h1 {
    font-size: 1.75rem;
  }
  
  .appointment-form-container {
    padding: 1.25rem;
  }
  
  .submit-button {
    width: 100%;
  }
}
</style>
{{ end }}