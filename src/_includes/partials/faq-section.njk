{# src/_includes/partials/faq-section.njk #}
{#
  常見問題 (FAQ) 區塊。
  接收一個 `faqs` 變數，它應該是一個包含問答對象的陣列。
  每個 FAQ 項目都具有可展開/收合的功能。
  符合藍圖的 FAQ 區塊視覺設計。
#}
<section class="py-12 md:py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl md:text-4xl font-heading font-bold text-center text-brand-blue-700 mb-10">常見問題</h2>

    <div class="max-w-3xl mx-auto space-y-4">
      {% for faq in faqs %}
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <button class="faq-toggle w-full flex justify-between items-center p-5 text-left text-lg md:text-xl font-semibold text-gray-800 hover:bg-gray-100 transition-colors duration-200 focus:outline-none"
                aria-expanded="false" aria-controls="faq-answer-{{ loop.index }}">
          <span>{{ faq.question }}</span>
          <span class="material-icons faq-icon transform transition-transform duration-200">add</span>
        </button>
        <div id="faq-answer-{{ loop.index }}" class="faq-answer hidden px-5 pb-5 text-gray-700 text-base leading-relaxed" style="max-height: 0; overflow: hidden;">
          <p>{{ faq.answer | safe }}</p> {# 使用 safe 過濾器以允許 HTML 內容 #}
        </div>
      </div>
      {% endfor %}
    </div>

    {% if show_all_faqs_link %}
    <div class="text-center mt-10">
      <a href="/faq/" class="inline-block bg-brand-blue-700 hover:bg-brand-blue-800 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md">
        查看所有常見問題
      </a>
    </div>
    {% endif %}
  </div>
</section>

{# 內嵌 JavaScript 處理 FAQ 展開/收合邏輯 #}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const faqToggles = document.querySelectorAll('.faq-toggle');

    faqToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const answer = toggle.nextElementSibling;
        const icon = toggle.querySelector('.faq-icon');
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
          answer.style.maxHeight = '0';
          answer.classList.add('hidden');
          toggle.setAttribute('aria-expanded', 'false');
          icon.textContent = 'add';
        } else {
          // 關閉所有其他已開啟的 FAQ
          faqToggles.forEach(otherToggle => {
            if (otherToggle !== toggle && otherToggle.getAttribute('aria-expanded') === 'true') {
              const otherAnswer = otherToggle.nextElementSibling;
              const otherIcon = otherToggle.querySelector('.faq-icon');
              otherAnswer.style.maxHeight = '0';
              otherAnswer.classList.add('hidden');
              otherToggle.setAttribute('aria-expanded', 'false');
              otherIcon.textContent = 'add';
            }
          });

          answer.classList.remove('hidden');
          answer.style.maxHeight = answer.scrollHeight + 'px'; // 設定高度以實現動畫
          toggle.setAttribute('aria-expanded', 'true');
          icon.textContent = 'remove';
        }
      });
    });
  });
</script>

<style>
  /* 確保 max-height 過渡效果 */
  .faq-answer {
    transition: max-height 0.3s ease-out;
  }
</style>