{# src/_includes/partials/structured-data.njk #}
{#
  這個 Nunjucks Partial 用於動態生成 JSON-LD 結構化資料。
  它會根據當前頁面的類型和全局數據 (site, seo) 生成對應的 Schema。
#}
<script type="application/ld+json">
[
  {# WebSite Schema - 定義網站本身 #}
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": "{{ site.baseUrl }}",
    "name": "{{ site.name }}",
    "description": "{{ site.description }}",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ site.baseUrl }}/articles/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  },
  {# Organization Schema - 定義事務所作為一個組織 #}
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "{{ site.name }}",
    "url": "{{ site.baseUrl }}",
    "logo": "{{ site.baseUrl }}{{ site.logoPath }}",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "{{ contact.phone }}",
      "contactType": "customer service"
    },
    "sameAs": [
      "{{ site.socialLinks.threads }}", {# Thread 連結 #}
      "{{ site.socialLinks.line }}"   {# Line 連結 #}
      {# 如果有更多社交媒體，請在此處添加 #}
    ]
  },
  {# LocalBusiness Schema - 定義事務所作為一個在地商家 #}
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "{{ site.name }}",
    "image": "{{ site.baseUrl }}{{ seo.defaultImage }}",
    "url": "{{ site.baseUrl }}",
    "telephone": "{{ contact.phone }}",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "{{ contact.address | split('台中市') | last | trim }}", {# 假設地址以 '台中市' 開頭，取之後的部分為街名 #}
      "addressLocality": "台中市",
      "addressRegion": "台中",
      "postalCode": "402", {# 範例郵遞區號，請替換 #}
      "addressCountry": "TW"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": 24.13715,  {# 請替換為實際經緯度 #}
      "longitude": 120.6869 # 請替換為實際經緯度 #}
    },
    "openingHoursSpecification": [
      {% for hour in contact.businessHours %}
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "{{ hour.day | replace('週一', 'Monday') | replace('週二', 'Tuesday') | replace('週三', 'Wednesday') | replace('週四', 'Thursday') | replace('週五', 'Friday') | replace('週六', 'Saturday') | replace('週日', 'Sunday') | replace('至', '-') }}",
        "opens": "{{ hour.time | split(' - ')[0] }}",
        "closes": "{{ hour.time | split(' - ')[1] }}"
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ],
    "priceRange": "$$", {# 價格範圍，可調整 #}
    "hasMap": "{{ contact.mapEmbedUrl }}",
    "description": "{{ site.description }}",
    "areaServed": {
      "@type": "City",
      "name": "台中市"
    },
    "servesCuisine": "Accounting Services", {# 這個欄位通常用於餐廳，但可以借用於描述服務性質 #}
    "url": "{{ site.baseUrl }}"
    {# 針對更細化的服務類型，可參考以下例子，但這裡暫不全部列出以保持簡潔 #}
    {#
    "makesOffer": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "AccountingService",
          "name": "稅務申報"
        }
      },
      {
        "@type": "AccountingService",
        "name": "審計服務"
      },
      {
        "@type": "ConsultingService",
        "name": "諮詢服務"
      },
      {
        "@type": "LegalService", {# 或 GovernmentService #}
        "name": "工商登記服務"
      }
    ]
    #}
  },
  {# WebPage Schema - 定義當前頁面 #}
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "{{ title }}",
    "url": "{{ site.baseUrl }}{{ page.url }}",
    "description": "{{ description }}",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ site.baseUrl }}{{ page.url }}"
    },
    "datePublished": "{{ page.date | date('YYYY-MM-DD') }}", {# 使用頁面創建日期，或實際發布日期 #}
    "dateModified": "{{ page.date | date('YYYY-MM-DD') }}",  {# 通常與發布日期相同，若有更新則不同 #}
    "author": {
      "@type": "Organization",
      "name": "{{ site.author }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ site.name }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ site.baseUrl }}{{ site.logoPath }}"
      }
    }
    {% if image %}
    ,"image": {
        "@type": "ImageObject",
        "url": "{{ site.baseUrl }}{{ image }}"
    }
    {% endif %}
  }
]
</script>